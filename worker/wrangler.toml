name = "nadmail-worker"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Custom Domain — 自動建立 DNS record 和 SSL 憑證
routes = [
  { pattern = "api.nadmail.ai", custom_domain = true }
]

[vars]
DOMAIN = "nadmail.ai"
MONAD_RPC_URL = "https://rpc.monad.xyz"
NADFUN_API_URL = "https://api.nadapp.net"
NADFUN_LENS = "0x7e78A8DE94f21804F7a17F4E8BF9EC2c872187ea"
NADFUN_ROUTER = "0x6F6B8F1a20703309951a5127c45B49b1CD981A22"
NADFUN_CURVE = "0xA7283d07812a02AFB7C09B60f8896bCEA3F90aCE"
WMON = "0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A"
WALLET_ADDRESS = "0x4BbdB896eCEd7d202AD7933cEB220F7f39d0a9Fe"

# D1 Database — 帳號與郵件索引
[[d1_databases]]
binding = "DB"
database_name = "nadmail-db"
database_id = "aa4c9192-f99f-450e-8474-d49764b4bd42"

# R2 Bucket — 原始郵件儲存
[[r2_buckets]]
binding = "EMAIL_STORE"
bucket_name = "nadmail-emails"

# KV Namespace — SIWE nonce 暫存
[[kv_namespaces]]
binding = "NONCE_KV"
id = "95f56c7825ad40499b0574223b2e652f"

# KV Namespace — $DIPLOMAT agent state
[[kv_namespaces]]
binding = "AGENT_KV"
id = "efe4fa7828fb4c839f4abcbe019f496a"

# Cron Trigger — $DIPLOMAT agent 每 30 分鐘跑一次
[triggers]
crons = ["*/30 * * * *"]

# Email 寄信 binding（不限制目的地，由程式碼控制）
[[send_email]]
name = "SEND_EMAIL"
