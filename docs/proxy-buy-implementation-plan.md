# NadMail Proxy-Buy å¯¦ä½œè¨ˆç•«

> æ—¥æœŸ: 2026-02-15
> ç‹€æ…‹: è¦åŠƒä¸­

---

## 1. ç”¨æˆ¶é«”é©—æµç¨‹

### 1.1 æŸ¥è©¢èˆ‡å°è³¼

```
ç”¨æˆ¶è¼¸å…¥ handle â†’ Check Availability
    â†“
â”Œâ”€ Available â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                   â”‚
â”‚  âœ… cloudlobster@nadmail.ai is available!         â”‚
â”‚                                                   â”‚
â”‚  .nad Name Price:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Registration fee:     ~~512 MON~~      â”‚      â”‚
â”‚  â”‚ Discount (Xmas Gift): -50%             â”‚      â”‚
â”‚  â”‚ Final price:          256 MON (~$6)    â”‚      â”‚
â”‚  â”‚ Service fee (15%):    +38.4 MON        â”‚      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚      â”‚
â”‚  â”‚ Total:                294.4 MON        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                   â”‚
â”‚  [ğŸ›’ Buy via NadMail (294.4 MON)]  â† proxy-buy  â”‚
â”‚  [ğŸ”— Buy on nad.domains â†—]         â† referral   â”‚
â”‚                                                   â”‚
â”‚  ğŸ’¡ Already have cloudlobster.nad?               â”‚
â”‚     [Claim Now â€” Free]                            â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è³¼è²·è·¯ç·š

**è·¯ç·š A: Referral å°è³¼ï¼ˆç°¡å–®ï¼‰**
1. é»æ“Šã€ŒBuy on nad.domainsã€
2. å¸¶ diplomat.nad çš„ referral code å°å‘ nad.domains
3. ç”¨æˆ¶è‡ªè¡Œå®Œæˆè³¼è²·
4. è³¼è²·å¾Œå›åˆ° NadMail é–‹è¨­å¸³è™Ÿ
5. NadMail ç²å¾— 10% referral ä½£é‡‘

**è·¯ç·š B: Proxy-Buyï¼ˆä¸€ç«™å¼ï¼‰**
1. é»æ“Šã€ŒBuy via NadMailã€
2. é€£çµéŒ¢åŒ… / æª¢æŸ¥é¤˜é¡
3. ç”¨æˆ¶ç™¼é€ MON åˆ° NadMail å­˜æ¬¾åœ°å€
4. NadMail å¾Œç«¯åŸ·è¡Œè³¼è²· + è½‰ç§» .nad åˆ°ç”¨æˆ¶
5. NadMail æ”¶å– 15% æœå‹™è²»
6. è‡ªå‹•é€²å…¥é–‹è¨­ email + ç™¼å¹£æµç¨‹

### 1.3 é¤˜é¡æª¢æŸ¥

```
éŒ¢åŒ…å·²é€£çµ
    â†“
æª¢æŸ¥ MON é¤˜é¡
    â”œâ”€ è¶³å¤  â†’ ç›´æ¥è³¼è²·
    â”œâ”€ ä¸è¶³ä½†æœ‰ ETH/Base â†’ æç¤ºï¼š
    â”‚   "You have 0.5 ETH on Base. Bridge to Monad?"
    â”‚   [Bridge via Orbiter â†—] [Bridge via Relay â†—]
    â””â”€ ç„¡é¤˜é¡ â†’ æç¤ºï¼š
        "You need MON to purchase. Buy MON on:"
        [Binance â†—] [OKX â†—] [Bridge from ETH â†—]
```

---

## 2. æŠ€è¡“æ¶æ§‹

### 2.1 å¾Œç«¯ API

#### GET `/api/register/nad-name-price/:name` (å·²æœ‰ï¼Œéœ€æ›´æ–°)

**Request:**
```
GET /api/register/nad-name-price/cloudlobster
```

**Response (æ›´æ–°ç‰ˆ):**
```json
{
  "name": "cloudlobster",
  "nad_name": "cloudlobster.nad",
  "available_nns": true,
  "available_nadmail": true,
  
  "pricing": {
    "base_price_mon": 512,
    "base_price_wei": "512000000000000000000",
    "discounts": [
      {
        "key": "DayOneMainnet",
        "description": "Xmas Gift",
        "percent": 50,
        "eligible": null
      }
    ],
    "best_discount_percent": 50,
    "discounted_price_mon": 256,
    "source": "contract"
  },
  
  "proxy_buy": {
    "available": true,
    "service_fee_percent": 15,
    "total_mon": 294.4,
    "total_wei": "294400000000000000000",
    "deposit_address": "0x4BbdB896eCEd7d202AD7933cEB220F7f39d0a9Fe",
    "method": "POST /api/register/buy-nad-name/quote"
  },
  
  "referral": {
    "url": "https://app.nad.domains?rc=VQp3ICKPVsZ4WCAsWiN4XDV5ZslfXCNiVvIOHsIuXCDiAMAOZil0WMR0",
    "commission_percent": 10,
    "referrer": "diplomat.nad"
  },
  
  "nadcard_url": "https://api.nad.domains/nadcard/cloudlobster.nad"
}
```

#### POST `/api/register/buy-nad-name/quote` (å·²æœ‰ï¼Œéœ€æ›´æ–°)

**Request:**
```json
{
  "name": "cloudlobster",
  "buyer_address": "0x..."
}
```

**Response:**
```json
{
  "name": "cloudlobster",
  "deposit_address": "0x4BbdB896eCEd7d202AD7933cEB220F7f39d0a9Fe",
  "amount_mon": 294.4,
  "amount_wei": "294400000000000000000",
  "breakdown": {
    "nns_price": 256,
    "service_fee": 38.4,
    "service_fee_percent": 15
  },
  "expires_at": "2026-02-15T16:00:00Z",
  "quote_id": "q_abc123"
}
```

#### POST `/api/register/buy-nad-name` (å·²æœ‰ï¼Œéœ€æ›´æ–°)

**Request:**
```json
{
  "name": "cloudlobster",
  "tx_hash": "0x...",
  "quote_id": "q_abc123",
  "buyer_address": "0x..."
}
```

**Flow:**
1. é©—è­‰ tx_hashï¼ˆç¢ºèªé‡‘é¡æ­£ç¢ºã€å·²ç¢ºèªï¼‰
2. åŸ·è¡Œ NNS è³¼è²·ï¼ˆä½¿ç”¨ NadMail éŒ¢åŒ…ï¼‰
3. è½‰ç§» .nad åˆ° buyer_address
4. æœå‹™è²»ç•™åœ¨ NadMail éŒ¢åŒ…ï¼ˆä¹‹å¾Œè½‰åˆ° diplomat.nadï¼‰
5. è‡ªå‹•é–‹è¨­ NadMail å¸³è™Ÿ + ç™¼è¡Œ token

#### GET `/api/register/balance/:address` (æ–°å¢)

**Response:**
```json
{
  "address": "0x...",
  "balances": {
    "monad": { "balance_mon": 765.5, "sufficient": true },
    "ethereum": { "balance_eth": 0.5, "bridge_options": ["orbiter", "relay"] },
    "base": { "balance_eth": 0.1, "bridge_options": ["orbiter"] }
  },
  "required_mon": 294.4
}
```

### 2.2 å‰ç«¯æ›´æ–° (Landing.tsx)

```
éœ€è¦æ›´æ–°çš„å…ƒä»¶ï¼š
â”œâ”€â”€ PriceDisplay        â† åƒ¹æ ¼é¡¯ç¤ºï¼ˆå«æŠ˜æ‰£ï¼‰
â”œâ”€â”€ ProxyBuyButton      â† ä¸€ç«™å¼è³¼è²·æŒ‰éˆ•
â”œâ”€â”€ ReferralButton      â† å°è³¼æŒ‰éˆ•
â”œâ”€â”€ BalanceChecker      â† éŒ¢åŒ…é¤˜é¡æª¢æŸ¥
â”œâ”€â”€ BridgeHelper        â† è·¨éˆæç¤º
â””â”€â”€ PurchaseFlow        â† è³¼è²·æµç¨‹ï¼ˆquote â†’ pay â†’ confirmï¼‰
```

### 2.3 åˆç´„äº’å‹•

```
Price Query:
â”œâ”€â”€ PriceOracleV2.getRegisteringPriceInToken(name, 0x0)
â”‚   â†’ base price (512 MON)
â”œâ”€â”€ Registrar.getActiveDiscounts()
â”‚   â†’ discount list (18 active)
â””â”€â”€ DiscountVerifier.isEligibleForDiscount(buyer, proof)
    â†’ eligible? (éœ€è¦ Merkle proof)

Purchase:
â”œâ”€â”€ Registrar.registerWithSignature(RegisterData, signature)
â”‚   RegisterData = {
â”‚     name, nameOwner, setAsPrimaryName,
â”‚     referrer, discountKey, discountClaimProof,
â”‚     nonce, deadline, attributes, paymentToken
â”‚   }
â”‚   âš ï¸ éœ€è¦ NNS å¾Œç«¯ç°½åï¼
â””â”€â”€ NNS.transferFrom(from, to, tokenId)
    â†’ è½‰ç§» .nad åˆ°è²·å®¶
```

---

## 3. é—œéµå•é¡Œ & å¾…ç ”ç©¶

### 3.1 âœ… registerWithSignature çš„ signatureï¼ˆå·²è§£æ±ºï¼ï¼‰

**API Endpoint:**
```
GET https://api.nad.domains/v3/register/signature?data=<encoded>
```

**ç·¨ç¢¼æ–¹å¼:** JSON â†’ Base64 â†’ Caesar Cipher (shift -19)
**è§£ç¢¼æ–¹å¼:** Caesar Cipher (shift +19) â†’ Base64 â†’ JSON

**Request Data:**
```json
{
  "name": "testlobster999",
  "nameOwner": "0x94c72f43...",
  "setAsPrimaryName": true,
  "referrer": "0x0000...",
  "discountKey": "0x0000...",
  "discountClaimProof": "0x",
  "attributes": [],
  "paymentToken": "0x0000...",
  "chainId": "143"
}
```

**Response (è§£ç¢¼å¾Œ):**
```json
{
  "signature": "0x7b11c926...",
  "nonce": "88029487...",
  "deadline": "1771171254"
}
```

**æ³¨æ„:** ä¸éœ€è¦ cookie æˆ–èªè­‰ï¼å…¬é–‹ APIï¼

### 3.2 âœ… æŠ˜æ‰£çš„ Merkle Proofï¼ˆå·²è§£æ±ºï¼ï¼‰

**API Endpoint:**
```
GET https://api.nad.domains/discount-proofs?claimer=<address>&chainId=143&name=<name>
```

**Response:**
```json
{
  "proofs": [
    {
      "discountKey": "DayOneMainnet",
      "validationData": "0x00000000...ï¼ˆMerkle proofï¼‰"
    }
  ]
}
```

**æ³¨æ„:**
- å…¬é–‹ APIï¼Œä¸éœ€è¦èªè­‰ï¼
- Cloud Lobster éŒ¢åŒ…æœ‰ DayOneMainnet (Xmas Gift 50%) è³‡æ ¼
- validationData ç›´æ¥åŒ…å«å®Œæ•´çš„ Merkle proof
- Proxy-buy æ™‚å¯ä»¥ç”¨è²·å®¶çš„åœ°å€æŸ¥è©¢æŠ˜æ‰£

### 3.3 ğŸŸ¡ Referral Code æ ¼å¼

å·²çŸ¥ï¼š
- rc åƒæ•¸æ˜¯ base64 ç·¨ç¢¼
- å‰ 20 bytes æ˜¯ referrer åœ°å€
- å¾Œ 22 bytes ç”¨é€”ä¸æ˜

- [ ] éœ€è¦é€£çµéŒ¢åŒ…å¾Œåœ¨ nad.domains ç”Ÿæˆ referral code
- [ ] ç¢ºèª diplomat.nad çš„ referral code æ˜¯å¦é•·æœŸæœ‰æ•ˆ

### 3.4 ğŸŸ¡ æœå‹™è²»åƒæ•¸åŒ–

```toml
# wrangler.toml
[vars]
SERVICE_FEE_PERCENT = "15"
FEE_RECIPIENT = "0x7e0F24854c7189C9B709132fEb6e953D4EC74424"  # diplomat.nad
```

### 3.5 ğŸŸ¢ é¤˜é¡æª¢æŸ¥

- Monad: ç›´æ¥ RPC `eth_getBalance`
- ETH/Base: éœ€è¦å¤šéˆ RPCï¼ˆå¯ç”¨ Alchemy/Infuraï¼‰
- æˆ–è€…å‰ç«¯ç”¨ wagmi è®€å–

---

## 4. å¯¦ä½œé †åº

### Phase 1: åƒ¹æ ¼é¡¯ç¤º + å°è³¼ï¼ˆæœ€å¿«ä¸Šç·šï¼‰
1. [x] ä¿®å¾© price APIï¼ˆRPC å•é¡Œï¼‰
2. [ ] æ›´æ–° price API â€” åŠ å…¥ `getActiveDiscounts()` æŠ˜æ‰£åˆ—è¡¨
3. [ ] æ›´æ–° price API â€” åŠ å…¥ diplomat.nad referral URL
4. [ ] æ›´æ–°å‰ç«¯ â€” é¡¯ç¤ºåƒ¹æ ¼ï¼ˆåŸåƒ¹åŠƒæ‰ + æŠ˜æ‰£ + æœ€çµ‚åƒ¹æ ¼ï¼‰
5. [ ] æ›´æ–°å‰ç«¯ â€” åŠ å…¥ã€ŒBuy on nad.domainsã€referral æŒ‰éˆ•
6. [ ] æ¸¬è©¦ diplomat.nad referral é€£çµæ˜¯å¦æœ‰æ•ˆ

### Phase 2: Proxy-Buy æ ¸å¿ƒ
7. [ ] ç ”ç©¶ registerWithSignature çš„ signature ä¾†æº
8. [ ] ç ”ç©¶ Merkle proof å–å¾—æ–¹å¼
9. [ ] å¯¦ä½œ quote APIï¼ˆå«æœå‹™è²»è¨ˆç®—ï¼‰
10. [ ] å¯¦ä½œ buy APIï¼ˆåŸ·è¡Œè³¼è²· + è½‰ç§»ï¼‰
11. [ ] æœå‹™è²»è‡ªå‹•è½‰å¸³åˆ° diplomat.nad

### Phase 3: é¤˜é¡ & è·¨éˆ
12. [ ] å¯¦ä½œ balance API
13. [ ] å‰ç«¯éŒ¢åŒ…é€£çµ + é¤˜é¡é¡¯ç¤º
14. [ ] è·¨éˆ bridge æç¤º

### Phase 4: AI API
15. [ ] AI-friendly APIï¼ˆç°¡åŒ–ç‰ˆï¼Œä¸€å€‹ endpoint å®Œæˆæ‰€æœ‰ï¼‰
16. [ ] æ–‡ä»¶ + ç¯„ä¾‹

---

## 5. åˆç´„åœ°å€

| åç¨± | åœ°å€ |
|------|------|
| NNS Registrar | `0xE18a7550AA35895c87A1069d1B775Fa275Bc93Fb` |
| PriceOracleV2 | `0xdF0e18bb6d8c5385d285C3c67919E99c0dce020d` |
| NadMail Wallet | `0x4BbdB896eCEd7d202AD7933cEB220F7f39d0a9Fe` |
| Diplomat.nad | `0x7e0F24854c7189C9B709132fEb6e953D4EC74424` |
| Cloud Lobster | `0x94c72f43F9F2E04Bcf1545021725353DC177f7E6` |

## 6. Referral è³‡è¨Š

| é …ç›® | å€¼ |
|------|-----|
| Referrer | diplomat.nad |
| Referral URL | `https://app.nad.domains?rc=VQp3ICKPVsZ4WCAsWiN4XDV5ZslfXCNiVvIOHsIuXCDiAMAOZil0WMR0` |
| Commission | 10% |
